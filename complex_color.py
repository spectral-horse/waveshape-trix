import matplotlib.pyplot as plt
import numpy as np
from PIL import Image



cet_c6 = np.array([
    [246,  55,  24],
    [247,  54,  28],
    [247,  54,  33],
    [247,  55,  37],
    [248,  56,  40],
    [248,  58,  42],
    [249,  60,  44],
    [250,  62,  48],
    [251,  66,  52],
    [252,  69,  57],
    [252,  73,  61],
    [253,  76,  65],
    [254,  80,  69],
    [254,  84,  74],
    [254,  87,  78],
    [254,  91,  82],
    [255,  94,  86],
    [255,  97,  89],
    [255,  99,  93],
    [255, 103,  97],
    [255, 106, 102],
    [255, 110, 107],
    [255, 114, 112],
    [255, 118, 116],
    [255, 121, 121],
    [255, 124, 125],
    [255, 127, 129],
    [255, 130, 134],
    [255, 134, 139],
    [255, 138, 145],
    [255, 142, 150],
    [255, 146, 155],
    [255, 149, 160],
    [255, 152, 165],
    [255, 155, 168],
    [255, 157, 173],
    [255, 160, 178],
    [255, 163, 182],
    [255, 165, 187],
    [255, 169, 192],
    [255, 171, 197],
    [255, 174, 201],
    [255, 176, 205],
    [255, 178, 209],
    [255, 181, 213],
    [254, 183, 218],
    [254, 185, 222],
    [254, 187, 227],
    [254, 188, 230],
    [252, 189, 234],
    [250, 189, 237],
    [248, 190, 240],
    [245, 190, 244],
    [243, 190, 246],
    [240, 190, 248],
    [238, 190, 250],
    [235, 190, 251],
    [233, 189, 252],
    [230, 188, 253],
    [226, 187, 254],
    [222, 185, 254],
    [219, 184, 254],
    [216, 182, 254],
    [212, 180, 255],
    [208, 178, 255],
    [205, 177, 255],
    [201, 175, 255],
    [198, 173, 255],
    [196, 171, 255],
    [192, 170, 255],
    [188, 168, 255],
    [184, 166, 255],
    [180, 164, 255],
    [176, 161, 255],
    [172, 159, 255],
    [167, 157, 255],
    [164, 155, 255],
    [161, 154, 255],
    [158, 153, 255],
    [154, 151, 255],
    [150, 148, 255],
    [145, 146, 255],
    [140, 144, 255],
    [136, 142, 255],
    [131, 141, 255],
    [128, 139, 255],
    [124, 138, 255],
    [120, 137, 255],
    [116, 135, 255],
    [111, 134, 255],
    [106, 132, 255],
    [101, 131, 255],
    [ 96, 130, 255],
    [ 90, 129, 255],
    [ 85, 129, 255],
    [ 80, 128, 255],
    [ 75, 128, 255],
    [ 71, 128, 255],
    [ 67, 128, 255],
    [ 62, 129, 255],
    [ 58, 130, 255],
    [ 55, 130, 255],
    [ 51, 131, 255],
    [ 48, 132, 255],
    [ 46, 133, 255],
    [ 43, 135, 255],
    [ 41, 137, 255],
    [ 40, 139, 255],
    [ 40, 141, 255],
    [ 39, 143, 255],
    [ 39, 145, 255],
    [ 39, 148, 255],
    [ 40, 150, 255],
    [ 40, 152, 255],
    [ 41, 155, 255],
    [ 42, 157, 255],
    [ 43, 160, 255],
    [ 44, 163, 255],
    [ 44, 165, 255],
    [ 45, 167, 255],
    [ 46, 170, 255],
    [ 47, 173, 255],
    [ 48, 175, 255],
    [ 48, 178, 255],
    [ 48, 181, 255],
    [ 48, 184, 255],
    [ 48, 187, 255],
    [ 49, 189, 255],
    [ 48, 191, 255],
    [ 48, 194, 255],
    [ 48, 196, 255],
    [ 48, 199, 254],
    [ 48, 201, 254],
    [ 47, 203, 254],
    [ 47, 206, 254],
    [ 46, 209, 254],
    [ 45, 211, 253],
    [ 44, 214, 252],
    [ 44, 217, 251],
    [ 43, 219, 251],
    [ 42, 222, 250],
    [ 41, 224, 249],
    [ 40, 225, 248],
    [ 39, 226, 247],
    [ 39, 227, 245],
    [ 38, 229, 243],
    [ 37, 230, 241],
    [ 37, 231, 238],
    [ 37, 231, 236],
    [ 37, 231, 234],
    [ 37, 231, 232],
    [ 37, 231, 229],
    [ 38, 231, 225],
    [ 39, 231, 221],
    [ 39, 230, 217],
    [ 40, 229, 213],
    [ 42, 227, 209],
    [ 42, 226, 206],
    [ 43, 226, 204],
    [ 44, 224, 200],
    [ 45, 222, 196],
    [ 45, 220, 191],
    [ 46, 218, 186],
    [ 47, 216, 181],
    [ 48, 212, 172],
    [ 49, 210, 168],
    [ 49, 208, 165],
    [ 49, 206, 161],
    [ 49, 205, 157],
    [ 50, 203, 153],
    [ 50, 200, 149],
    [ 49, 198, 145],
    [ 49, 196, 141],
    [ 49, 194, 136],
    [ 49, 191, 132],
    [ 49, 189, 128],
    [ 48, 187, 123],
    [ 48, 185, 119],
    [ 48, 183, 115],
    [ 47, 181, 111],
    [ 47, 179, 107],
    [ 46, 178, 103],
    [ 46, 175,  98],
    [ 45, 173,  93],
    [ 44, 170,  88],
    [ 44, 168,  84],
    [ 43, 167,  81],
    [ 43, 165,  77],
    [ 43, 163,  73],
    [ 43, 162,  69],
    [ 43, 160,  66],
    [ 43, 159,  61],
    [ 44, 158,  58],
    [ 44, 157,  55],
    [ 45, 156,  51],
    [ 47, 155,  47],
    [ 49, 154,  43],
    [ 52, 153,  40],
    [ 54, 153,  37],
    [ 57, 153,  34],
    [ 59, 153,  30],
    [ 62, 153,  28],
    [ 65, 154,  26],
    [ 68, 154,  23],
    [ 71, 155,  21],
    [ 74, 155,  19],
    [ 77, 156,  17],
    [ 81, 157,  15],
    [ 86, 158,  13],
    [ 90, 159,  11],
    [ 95, 161,   9],
    [ 99, 163,   7],
    [104, 164,   5],
    [108, 166,   4],
    [112, 168,   3],
    [115, 169,   3],
    [118, 170,   2],
    [122, 171,   2],
    [127, 173,   1],
    [131, 175,   1],
    [136, 177,   0],
    [141, 179,   0],
    [145, 181,   0],
    [148, 182,   0],
    [150, 183,   0],
    [155, 185,   0],
    [159, 187,   0],
    [164, 188,   0],
    [169, 190,   0],
    [173, 192,   0],
    [177, 193,   0],
    [179, 195,   0],
    [182, 196,   0],
    [187, 197,   0],
    [191, 199,   0],
    [195, 200,   0],
    [200, 202,   0],
    [204, 203,   0],
    [207, 204,   0],
    [211, 205,   0],
    [214, 206,   0],
    [217, 207,   0],
    [220, 208,   0],
    [223, 208,   0],
    [226, 208,   0],
    [229, 208,   0],
    [233, 208,   0],
    [235, 208,   0],
    [238, 208,   0],
    [240, 207,   0],
    [243, 206,   0],
    [245, 205,   0],
    [247, 204,   0],
    [249, 202,   0],
    [250, 200,   0],
    [251, 198,   0],
    [252, 195,   0],
    [253, 193,   0],
    [254, 191,   0],
    [254, 188,   0],
    [254, 185,   0],
    [254, 181,   0],
    [254, 179,   0],
    [255, 176,   0],
    [255, 173,   0],
    [255, 169,   0],
    [255, 166,   0],
    [255, 164,   0],
    [255, 161,   0],
    [255, 157,   0],
    [255, 153,   0],
    [254, 149,   0],
    [254, 146,   0],
    [254, 143,   0],
    [254, 140,   0],
    [254, 136,   0],
    [254, 133,   0],
    [253, 129,   0],
    [253, 125,   0],
    [252, 122,   0],
    [252, 118,   1],
    [252, 114,   1],
    [251, 110,   1],
    [251, 107,   2],
    [250, 104,   2],
    [250, 101,   3],
    [249,  98,   4],
    [249,  94,   5],
    [248,  89,   6],
    [248,  85,   7],
    [248,  81,   8],
    [247,  77,   9],
    [247,  73,  11],
    [247,  69,  13],
    [246,  66,  15],
    [246,  64,  16],
    [246,  62,  17],
    [246,  59,  19],
    [246,  57,  22]
])



def complex_to_rgb(z, threshold = 1):
    norm = np.sort(np.abs(z).ravel())
    norm_thresh = norm[np.argmax(norm >= norm.max()*threshold)]

    idcs = (cet_c6.shape[0]*np.angle(z)/(2*np.pi)).astype(int)%cet_c6.shape[0]
    val = np.minimum(np.abs(z)/norm_thresh, 1)
    rgb = cet_c6[idcs]*val[..., None]

    return rgb.astype("u1")

def imshow_complex(z, **kwargs):
    plt.imshow(complex_to_rgb(z), **kwargs)

def save_complex_img(path, z):
    Image.fromarray(complex_to_rgb(z)).save(path)
